<!DOCTYPE html>
<html>

<!-- Mirrored from www. .com/prevention/open-redirects by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 03 Aug 2023 12:48:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>

  <title>Preventing Malicious Redirects</title>

  <link rel="shortcut icon" type="image/x-icon" href="https://d1o5lmfp4gliop.cloudfront.net/assets/favicon-d2fd4b2666fd6a6c2eacee13d0d844a558942079e549b7f971085de9cab55511.ico" />

  <link rel="apple-touch-icon"                 href="../touch-icon-iphone.png">
  <link rel="apple-touch-icon" sizes="76x76"   href="../touch-icon-ipad.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../touch-icon-iphone-retina.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../touch-icon-ipad-retina.png">

  <meta name="viewport" content="width=device-width">

  <link rel="stylesheet" media="all" href="../../d1o5lmfp4gliop.cloudfront.net/assets/application-1f27c21e9caba5e224e9039708363bb3d6393bcd0cec34182ef97d314c3d7fe1.css" />
  <script src="../../d1o5lmfp4gliop.cloudfront.net/assets/application-9865c3a61c1ffdfed4986c79c8214c39119b9dd0fa2157ea9bdc023c8edbd459.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="y9StnOIfLlKQ6Xm+A9BR6pOEKHdXcZ4r/Rf1//5nKtBSxCCuY0VObF3H9DesaCsNdz28WUL+g+KeY5GuvGxyIw==" />

  

  <meta property="og:url"          content="https://www. .com/prevention/open-redirects" />
<meta property="og:type"         content="website" />
<meta property="og:title"        content="Preventing Malicious Redirects" />
<meta property="og:description"  content="Most web-applications make use of redirects. If your site forwards to URLs supplied in a query string, you could be enabling phishing attacks. Let&#39;s see how you might be helping email scammers. →" />
<meta property="og:image"        content="https://www. .comhttps://d1o5lmfp4gliop.cloudfront.net/images/exercises/open-redirects/screenshot.png" />
<meta property="og:site_name"    content=" "/>

<meta property="fb:app_id"       content="495778420623064">

<meta name="description"         content="Most web-applications make use of redirects. If your site forwards to URLs supplied in a query string, you could be enabling phishing attacks. Let&#39;s see how you might be helping email scammers. →" />

<meta name="twitter:title"       content="Preventing Malicious Redirects">
<meta name="twitter:description" content="Most web-applications make use of redirects. If your site forwards to URLs supplied in a query string, you could be enabling phishing attacks. Let&#39;s see how you might be helping email scammers. → %>">

<meta name="application-name"                content=" "/>
<meta name="msapplication-TileColor"         content="#000000"/>
<meta name="msapplication-square70x70logo"   content="windows-tiny.png"/>
<meta name="msapplication-square150x150logo" content="windows-square.png"/>
<meta name="msapplication-wide310x150logo"   content="windows-wide.png"/>
<meta name="msapplication-square310x310logo" content="windows-large.png"/>


  



</head>


  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SZ91HC6JB6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SZ91HC6JB6');
  </script>



<body class="light-background logged-out prevention  unknown_device unknown_browser unknown_browser0 windows non-ie">

  <div class="content">


      <div class="header">
  <nav class="navbar navbar-expand-lg ">

    <div class="container-fluid">
      <button class="navbar-toggler navbar-toggler-right"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapsing-menu">
        <i class="fa fa-bars"></i>
      </button>


      <span class="navbar-brand logo">
        <a href="../index.html">
          <div class="title"> </div>
        </a>
      </span>

      <div class="navbar-collapse collapse justify-content-end" id="collapsing-menu">

        <div class="navbar-nav mr-auto">

        </div>

        <ul class="navbar-nav justify-content-end">


            <li class="nav-item nav-features"><a class="nav-link" href="../features.html">Features</a></li>
            <li class="nav-item nav-lessons"><a class="nav-link" href="../lessons.html">Lessons</a></li>
            <li class="nav-item nav-enterprise"><a class="nav-link" href="../enterprise.html">Enterprise</a></li>
            <li class="nav-item nav-owasp top 10"><a class="nav-link" href="../owasp.html">OWASP Top 10</a></li>
            <li class="nav-item nav-pci compliance"><a class="nav-link" href="../pci.html">PCI Compliance</a></li>
            <li class="nav-item nav-the book"><a class="nav-link" href="../book.html">The Book</a></li>
            <li class="nav-item nav-login"><a class="nav-link" href="../login.html">Login</a></li>
            <li class="nav-item nav-signup"><a class="nav-link" href="../join.html">SignUp</a></li>


        </ul>
      </div>
    </div>

  </nav>
</div>


      
<script>
  hljs.configure({ classPrefix: 'code-' });
  hljs.highlightAll();
</script>

<div class="main reading open-redirects">

  <div class="container">
    <div class="row prevention-tips has-sponsor">
      <div class="row title modest">
        Preventing Malicious Redirects
      </div>

      <p>If your site permits open redirects, you may be unknowingly helping attackers
take advantage of your user base.</p>



      <h3 id="risks">Risks</h3>

      <div class="ratings">
  <div class="rating prevalence common">
    <div class="category">
      <span class="category-label">
        Prevalence
      </span>

      <span class="description">
        Common
      </span>
    </div>

    <div class="level">
      <div class="rating-icons prevalence common">
        <img class="on one" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-prevelance-on-08c87a35753a8cffcf36b11e7964cfaf357ed53beea25705689f8b289b9260db.png" />
        <img class="on two" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-prevelance-on-08c87a35753a8cffcf36b11e7964cfaf357ed53beea25705689f8b289b9260db.png" />
        <img class="on three" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-prevelance-on-08c87a35753a8cffcf36b11e7964cfaf357ed53beea25705689f8b289b9260db.png" />
      </div>
   </div>
  </div>

  <div class="rating exploitability easy">
    <div class="category">
      <span class="category-label">
        Exploitability
      </span>

      <span class="description">
        Easy
      </span>
    </div>

    <div class="level">
      <div class="rating-icons exploitability easy"">
        <img class="on one" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-exploitability-on-72a414cbfd6607547d507635de7609d1ba1bbfc36e454851949c4efc6fdd6f82.png" />
        <img class="on two" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-exploitability-on-72a414cbfd6607547d507635de7609d1ba1bbfc36e454851949c4efc6fdd6f82.png" />
        <img class="on three" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-exploitability-on-72a414cbfd6607547d507635de7609d1ba1bbfc36e454851949c4efc6fdd6f82.png" />
      </div>
    </div>
  </div>

  <div class="rating impact worrying">
    <div class="category">
      <span class="category-label">
        Impact
      </span>

      <span class="description">
        Worrying
      </span>
    </div>

    <div class="level">
      <div class="rating-icons impact worrying">
        <img class="on one" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-impact-on-56af21599bf07cebbffbecceec1537a9471628fb1d3374433c1d9b8b1ab703bf.png" />
        <img class="on two" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-impact-on-56af21599bf07cebbffbecceec1537a9471628fb1d3374433c1d9b8b1ab703bf.png" />
        <img class="on three" src="../../d1o5lmfp4gliop.cloudfront.net/assets/icons/rating-impact-on-56af21599bf07cebbffbecceec1537a9471628fb1d3374433c1d9b8b1ab703bf.png" />
      </div>
    </div>
  </div>
</div>

      <p>Redirects are a useful function to have when building a website. If a user 
attempts to access a resource before they are logged in, it is conventional to 
redirect them to the login page, put the original URL in a query parameter, and 
after they have logged in, automatically redirect them to their original 
destination. This type of functionality shows you are putting thought into the
user experience, and is to be encouraged. However, you need to be sure anywhere 
you do redirects, they are done safely – otherwise you are putting your users in 
harm’s way by enabling <a href="../glossary.html">phishing attacks</a>.</p>

<p>Modern web-mail services are very good at spotting spam and other types of
malicious messages. One detection method they use is to parse the out-bound
links in HTML emails. These links are compared to a black-list of banned
domains; if the domain is deemed to be malicious, the email is redirected to the junk folder.</p>

<p>This is why spammers and phishers find <strong>open redirects</strong> so enticing.
If they can “bounce” a user off your website (an apparently valid domain), 
their messages are less likely to be marked as malicious. If the user clicks on 
the link, they will see your website in the link, but they will end up at whatever 
site the attacker wants to direct them to. A confused user might download 
malware or worse, because of the trust they put in your site!</p>




      <h3 id="protection">Protection</h3>

<h6 id="disallow-offsite-redirects">Disallow Offsite Redirects</h6>

<p>You can prevent redirects to other domains by checking the URL being passed 
to the redirect function. Make sure all redirect URLs are <strong>relative paths</strong> – 
i.e. they start with a single <code>/</code> character. (Note that URLs starting with
<code>//</code> will be interpreted by the browser as a protocol agnostic, absolute URL –
so they should be rejected too.)</p>

<p>If you <em>do</em> need to perform external redirects, consider restricting the
individual sites that you permit redirects to.</p>

<h6 id="check-the-referrer-when-doing-redirects">Check the Referrer When Doing Redirects</h6>

<p>Redirects to URLs passed in query parameters should only be triggered
by pages on your site. Any other sites triggering a redirect should
be treated with extreme suspicion. As a second layer of defense, check that
the <code>Referer</code> in the HTTP request matches your domain whenever you perform a
redirect.</p>

<h3 id="code-samples">Code Samples</h3>

<p>The code samples below demonstrate how to check that a URL is a relative path.</p>

<a class="toggle collapsed" data-bs-toggle="collapse" href="#pythoneff7cd59-81aa-48cd-93b2-a71980ac2484-examples" aria-expanded="false" aria-controls="pythoneff7cd59-81aa-48cd-93b2-a71980ac2484-examples"><h5 id="python">Python</h5></a><span id="pythoneff7cd59-81aa-48cd-93b2-a71980ac2484-examples" class="collapse">

<p>Validate for relative paths with:</p>

<pre><code class="language-python">
import re

def is_relative(url):
  return re.match(r"^\/[^\/\\]", url)

</code></pre>

</span><a class="toggle collapsed" data-bs-toggle="collapse" href="#ruby53948cab-b2a0-4c3b-9ff4-eb813d82f2b6-examples" aria-expanded="false" aria-controls="ruby53948cab-b2a0-4c3b-9ff4-eb813d82f2b6-examples"><h5 id="ruby">Ruby</h5></a><span id="ruby53948cab-b2a0-4c3b-9ff4-eb813d82f2b6-examples" class="collapse">

<p>Validate for relative paths with:</p>

<pre><code class="language-ruby">
def is_relative(url)
  url =~ /^\/[^\/\\]/
end

</code></pre>

</span><a class="toggle collapsed" data-bs-toggle="collapse" href="#java142787cb-7dca-4fd7-9dcb-e3f67a12f76f-examples" aria-expanded="false" aria-controls="java142787cb-7dca-4fd7-9dcb-e3f67a12f76f-examples"><h5 id="java">Java</h5></a><span id="java142787cb-7dca-4fd7-9dcb-e3f67a12f76f-examples" class="collapse">

<p>A redirect like the following is open to abuse:</p>

<pre class="warning"><code class="language-java">
protected void doGet(HttpServletRequest request, HttpServletResponse response) {
  String url = request.getParameter("url");
  if (url != null) {
    response.sendRedirect(url);
  }
}

</code></pre>

<p>Make sure you validate the url parameter wherever you invoke the 
<a href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletResponse.html#sendRedirect(java.lang.String)"><code>sendRedirect</code></a>
method:</p>

<pre><code class="language-java">
protected void doGet(HttpServletRequest request, HttpServletResponse response) {
  String url = request.getParameter("url");
  if (url != null &amp;&amp; isRelative(url)) {
    response.sendRedirect(url);
  }
}

// Allow anything starting with "/", except paths starting
// "//" and "/\".
private boolean isRelative(String url) {
  return url.matches("/[^/\\]?.*");
}

</code></pre>

</span><a class="toggle collapsed" data-bs-toggle="collapse" href="#netb2679288-a0b4-477f-bd89-65666df8d3f9-examples" aria-expanded="false" aria-controls="netb2679288-a0b4-477f-bd89-65666df8d3f9-examples"><h5 id="net">.NET</h5></a><span id="netb2679288-a0b4-477f-bd89-65666df8d3f9-examples" class="collapse">

<p>Validate URLs with the following snippet:</p>

<pre class="captioned"><code class="language-c">
private bool IsRelativePath(string url)
{
   if (string.IsNullOrEmpty(url))
   {
      return false;
   }
   else
   {
      if (url.Length == 1) return true;

      // Allow anything starting with "/", except paths starting
      // "//" and "/\". Allow the "~/" syntax too.
      return (url[0] == '/' &amp;&amp; (url[1] != '/' &amp;&amp; url[1] != '\\')) ||
             (url[0] == '~' &amp;&amp; url[1] == '/');
   }
}

</code></pre>

<p class="caption">.NET allows the syntax <code>~/</code> for URLs relative to the
domain of your site - you can choose whether to support this in
redirects.</p>

</span><a class="toggle collapsed" data-bs-toggle="collapse" href="#node4b7a2638-2d06-4dbc-b52f-b93bfef1a115-examples" aria-expanded="false" aria-controls="node4b7a2638-2d06-4dbc-b52f-b93bfef1a115-examples"><h5 id="node">Node</h5></a><span id="node4b7a2638-2d06-4dbc-b52f-b93bfef1a115-examples" class="collapse">

<p>Validate relative paths with:</p>

<pre><code class="language-javascript">
function isRelative(url) {
  return url &amp;&amp; url.match(/^\/[^\/\\]/);
}

</code></pre>

</span><h3 id="other-considerations">Other Considerations</h3>

<h6 id="check-client-side-code-too">Check Client-Side Code Too!</h6>

<p>Redirects can happen in client-side JavaScript, too! Validate any code that
sets <code>window.location</code>, to ensure the URL is not taken from untrusted input.</p>

<h6 id="interstitial-pages">Interstitial Pages</h6>

<p>Some sites insert interstitial pages when the user is leaving the site –
<strong>“you are now leaving tinyrobotninjas.com, you will be automatically
redirected in 5 seconds”.</strong> This is a good defense against doppelganger
domains – websites that have a very similar domain name, in order to trick
the user into trusting them. If you implement an interstitial page that
passes the URL in the query parameter, be sure to check the <code>Referer</code> header,
or else they could be open to abuse.</p>

<h6 id="aggregator-sites">Aggregator Sites</h6>

<p>Aggregator sites often make use of redirects to do click-counting. URLs
are chosen by the community, then when a user clicks on the link, the
click-through count is incremented, and the user is redirected to their
destination. If your site implements this type of functionality, redirects to 
external sites are part of doing business. Just be sure to check the <code>Referer</code>
each time you do a redirect!</p>

<h3 id="further-reading">Further Reading</h3>

<ul>
  <li><a href="https://www.netsparker.com/blog/web-security/open-redirection-vulnerability-information-prevention/?utm_source= &amp;utm_medium=post&amp;utm_campaign=articlelink">What is an Open Redirection Vulnerability and How to Prevent it?</a></li>
</ul>


    </div>

      



  </div>


    <div class="container">
      <div class="row quiz-link">
        <a href="../joind21c.html?next=%2Fquiz%2Fopen-redirects">
          <div class="link-question">
            Got all that?
          </div>

          <div class="link-link">
            Test Yourself →
          </div>

          <div class="link-caption">
            <div>Take our quiz to make sure everything is clear</div>
          </div>
</a>      </div>
    </div>



</div>

      
  <footer class="regular">
  <div class="container">
    <ul>
      <li>
        <a href="../lessons.html">Lessons</a>
      </li>
      <li>
        <a href="../glossary.html">Glossary</a>
      </li>
      <li>
        <a href="../privacy.html">Privacy</a>
      </li>
      <li>
        <a href="../legal.html">Legal</a>
      </li>

      <li class="pull-right copyright">
          <a class="contact-us"
             title="Get in touch"
             href="mailto:question@ .com"
             rel="noopener noreferrer">
            <span class="fa-stack">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
            </span>
          </a>

        <a href="../index.html">
          <span style="font-family: 'Oxygen'">©</span> 2023  
</a>      </li>
    </ul>
  </div>
</footer>



  </div>

    <script src="../../d1o5lmfp4gliop.cloudfront.net/assets/cookieinfo-1af9cc137c2c2bc8ea4d469f45d357ec43dc6c23537bd0c96aa9b51ff416ce5e.js" id="cookieinfo"></script>

</body>

<script>
  $(function () {
    $('[data-bs-toggle="tooltip"]').tooltip({ container: 'body' });
  });
</script>


<!-- Mirrored from www. .com/prevention/open-redirects by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 03 Aug 2023 12:48:10 GMT -->
</html>
